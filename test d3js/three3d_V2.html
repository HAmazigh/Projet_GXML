<!DOCTYPE html>
<html>
    <head>
        <title> Three JS Tests! </title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        
        <style>

         #info {
    animation-duration: 3s;
    animation-name: slidein;
                }
  
  @keyframes slidein {
    from {
      margin-left: 100%;
      width: 300%
       }
    
    to {
      margin-left: 0%;
      width: 100%;
    }
                     }
            canvas{position: fixed; top:0; left:0;}
            #echelle{
                position: fixed;
                        }

            #info{
                position: fixed;
                top: 700px;
            }
            h3{
                color: white;
                text-decoration: underline;
            }
            p {
                color: white;
            }
            #r{
                color: red;
            }
            #b{
                color: blue;
            }
            #j{
                color: yellow;
            }
            
        </style>
        
    </head>
    <body>
        
        <div id="container">
            
        </div>
        <script src="//code.jquery.com/jquery-1.9.1.js"></script>
        <script src="https://rawgithub.com/mrdoob/three.js/master/build/three.js"></script>
        
        <script type="text/javascript">


            var _width = window.innerWidth;
            var _height = window.innerHeight;
            var controls;
            // moteur de rendu
            var renderer = new THREE.WebGLRenderer({antialias: true});

            renderer.setSize(_width, _height);
            
            $('#container').append(renderer.domElement);

            var json = localStorage.getItem("chaineJson");
             console.log("la chaine json"+json);

            var jsonParse = JSON.parse(json);

            var largeur = 10;
            var hauteur = 60;
           // console.log("la valeur de x est "+jsonParse[0].x1);
           // console.log("la longueur du tableau est "+jsonParse.length);
           var scene = new THREE.Scene;



           function init () {
           
            //La scene 
            
          

            //La géometrie
            var abGeometry = new THREE.CubeGeometry(10000, 1, 1);
            var orGeometry = new THREE.CubeGeometry(1, 10000, 1);
            var axGeometry = new THREE.CubeGeometry(1,1, 10000);

            var murGeometry = new THREE.CubeGeometry(200, 300, 44);

            //Material 
            var abMaterial = new THREE.MeshBasicMaterial({color: 0xf0c300,wireframe:true});
            var orMaterial = new THREE.MeshBasicMaterial({color: 0x007fff,wireframe:true});
            var axMaterial = new THREE.MeshBasicMaterial({color: 0xff0000,wireframe:true});

            var murMaterial = new THREE.MeshBasicMaterial( { color: 0x03C0ff, wireframe: false } );


            //les Objets
            var abscisse = new THREE.Mesh(abGeometry, abMaterial);
            var ordonnee = new THREE.Mesh(orGeometry, orMaterial);
            var axeZ = new THREE.Mesh(axGeometry, axMaterial);
            var mur = new THREE.Mesh(murGeometry, murMaterial);

            //    ordonnee.rotation.y = Math.PI * 180;
            //    abscisse.rotation.y = Math.PI * 180;

                
            
            scene.add(abscisse);
            scene.add(ordonnee);
            scene.add(axeZ);
           // scene.add(mur);



       }

           

//-------------------------------------------------------------------------------------------------------
//------------------------------> Création des murs à partir du fichier Json récuperé--------------------
//-------------------------------------------------------------------------------------------------------

            for (i=0; i < jsonParse.length; i++){

                
                var x1 = parseInt(jsonParse[i].x1);
                var x2 = parseInt(jsonParse[i].x2);
                var y1 = parseInt(jsonParse[i].y1);
                var y2 = parseInt(jsonParse[i].y2);
                var adjacent;
                var longueur = Math.sqrt(((x2-x1)*(x2-x1)) + ((y2-y1)*(y2-y1)));
                var angle ;
                var pante;
                var centre = [];

                 centre [0] = (x1 + x2 ) / 2 ;
                 centre [1] = (y1 + y2) / 2 ;

                 //   console.log ("le centre est ! "+centre[0]+" centre y"+centre[1]+" la longeur "+longueur);
                    

            //La géometry des murs 
                var murGeometry = new THREE.CubeGeometry(longueur, largeur, hauteur);

            //Material des murs

                var texture = new THREE.ImageUtils.loadTexture ('../assets/img/tex4.png');
                var murMaterial = new THREE.MeshBasicMaterial({map: texture,wireframe:false});

            //le mur
                var mur = new THREE.Mesh(murGeometry, murMaterial);

            scene.add(mur);

             mur.position.x = centre[0]; 
             mur.position.y = centre[1];
             mur.position.z = 0;

             //mur.rotation.z = 40 ; 
             adjacent = Math.sqrt(((x2-x1)*(x2-x1)));
             //console.log("adjacent = "+ adjacent+"__ hypotinus= "+longueur);

             angle = Math.acos(adjacent / longueur);
             //console.log("l'angle est "+ angle+"°");

             pante = (y2 - y1) / (x2 - x1);
           //  console.log("la pante de cette droite est : "+pante);

             if (pante < 0){
             mur.rotation.z = -angle;
         }else {
            mur.rotation.z = angle;
         }
         
         
         // Carema 
         
            camera = new THREE.PerspectiveCamera(450, _width / _height, 0.1, 10000);
            
            camera.position.x = 00;
            camera.position.y = 300;
            camera.position.z = 400;

            scene.add(camera);

            camera.lookAt( scene.position );
            //camera.position.set(0, 0, 500);
            
      }

//-------------------------------------------------------------------------------------------------------
//-------------------------------------------------> Fin  -----------------------------------------------
//-------------------------------------------------------------------------------------------------------

            
                         //La camera

          


            window.addEventListener( 'keydown', onKeyDown, false );

            function onKeyDown(event)
            {
                //currentlyPressedKeys[event.keyCode] = true;
                var keyCode =  event.which;
                switch (keyCode){

                case 37 : {// Left cursor key
                  //camera.rotateX -= 10;
                  camera.rotateOnAxis((new THREE.Vector3(0, 1, 0)).normalize(), degInRad(1));
          //      console.log("la touche left "+keyCode);
                } break;

                case 38 : {// up cursor key
                  //camera.position.y += 10;
                  camera.rotateOnAxis((new THREE.Vector3(1, 0, 0)).normalize(), degInRad(1));
           //     console.log("la touche up "+keyCode);
                } break;

                case 39 : {// right cursor key
                  //camera.rotateX += 10;
                  camera.rotateOnAxis((new THREE.Vector3(0, 1, 0)).normalize(), degInRad(-1));
           //     console.log("la touche right "+keyCode);
                }break;

                case 40 : {// down cursor key
                  //camera.position.y -= 10;
                  camera.rotateOnAxis((new THREE.Vector3(1, 0, 0)).normalize(), degInRad(-1));
           //     console.log("la touche down "+keyCode);
                }break;

                case 65 : {// z cursor key
                  camera.position.z += 10;
           //     console.log("la touche Z "+keyCode);
                }break;

                case 90 :{// z cursor key
                  camera.position.z -= 10;
           //     console.log("la touche z "+keyCode);
                }break;
            
            }   
            }
            
            function degInRad(deg) {
                return deg * Math.PI / 180;
            } 

            init();
            animate();


   function animate(){
             requestAnimationFrame( animate );
         //    mur.rotation.x += 0.01;
         //      mur.rotation.y += 0.02;
            renderer.render( scene, camera );
    
           }

            

        </script>

<div id="echelle">
<h3> L'échelle  (x,y,z) </h3>
    <p id="j"> Le Jaune c'est les Abscisses x </p>
    <p id="b"> Le bleu c'est les Ordonnées y</p>
    <p id="r"> Le rouge c'est pour l'axe des Z </p> 
</div>

<div id="info">
    <p>
Utilisez les fléches de direction pour se déplacer sur l'axe X ou Y <br>
Les deux touches 'A' et 'Z' pour se déplacer sur l'axe Z
    </p>
</div>

    </body>
</html>
