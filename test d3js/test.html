<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="../assets/css/style.css">
        <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
        <title>svg + d3js</title>
        <style>
            svg circle:hover{cursor: crosshair;}
            #zone-dessin{
                display: block;
                z-index: 2000;
                position: relative;
            }
            #bg{
                position: absolute;
                top: 2px;
                left: 222px;
                z-index: 100;
            }
        </style>
    </head>

    <body>
        <div id="bg">
            <svg width="401" height="401" xmlns="http://www.w3.org/2000/svg">
                <defs>
                <pattern id="smallGrid" width="10" height="10" patternUnits="userSpaceOnUse">
                    <path d="M 10 0 L 0 0 0 10" fill="none" stroke="gray" stroke-width="0.5"/>
                </pattern>
                <pattern id="grid" width="80" height="80" patternUnits="userSpaceOnUse">
                    <rect width="80" height="80" fill="url(#smallGrid)"/>
                    <path d="M 80 0 L 0 0 0 80" fill="none" stroke="gray" stroke-width="1"/>
                </pattern>
                </defs>

                <rect width="100%" height="100%" fill="url(#grid)" />
            </svg>
        </div>
        
        <div id="sidebar">
            <h3> Formulaire </h3>
        </div>
            

        <script type="text/javascript">

            var dataset = [],
                i = 0,j=0,
                dx=20, dy=20,
                _r = 4,
                _width=600, _height=600;
                
            var hasClicked = false;
            var pos=[], posNew=[];       

            var scene = d3.select("body")
                .append("svg")
                .attr("width", _width)
                .attr("height", _height)
                .attr("id", "zone-dessin")
                
           for(i=0; i<20; i++){
                // inserer les coordonnees de x y : format JSON {x:44, y:55} ..
                for(j=0; j<20; j++)
                    dataset.push({x:i, y:j});
            } 

            scene.selectAll("circle")
                .data(dataset)
                .enter().append("circle")
                .style("stroke", "gray")
                .style("fill", "white")
                .attr("r", _r)
                .attr("cx", function(d, i){return d.x*dx + _r})
                .attr("cy", function(d, i){ return d.y*dy + _r})
                .attr("class", 'point')
                .on("mouseover", function(){d3.select(this).style("fill", "red");})
                .on("mouseout", function(){d3.select(this).style("fill", "white");})
                .on("mousedown", clickManager);
                

            function clickManager(){
                if( !hasClicked ){
                    hasClicked = true;
                    pos = d3.mouse(this); posNew = pos;
                    console.log('x = '+pos[0]);
                    console.log('y = '+pos[1]); 
                }
                else{
                    pos = posNew;
                    posNew = d3.mouse(this);
                    console.log('new x = '+posNew[0]);
                    console.log('new y = '+posNew[1]);
                    hasClicked=false;
                    updateScene();
                }
                
            };
            
            function updateScene(){
                scene.append("line")
                     .attr("x1", pos[0])
                     .attr("y1", pos[1])
                     .attr("x2", posNew[0])
                     .attr("y2", posNew[1])
                     .attr("class", 'mur')
                     .style("stroke", "black")
                     .style("stroke-width", 4)
                     .on("mouseover",  function(){d3.select(this).style("fill", "blue");})
                     .on("mouseout",  function(){d3.select(this).style("fill", "black");})
                     .on("contextmenu", removeSelectedWall);
            }
            
            function removeSelectedWall(){
                d3.event.preventDefault();
                console.log("un click droit !");
                //var numMur = d3.select(this).attr("num");
                d3.select(this).remove();
                
            }
            
            

        </script>
    </body>
</html>
